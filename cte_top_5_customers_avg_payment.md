```
WITH TOP_10_COUNTRIES AS
    (SELECT COUNTRY.COUNTRY
        FROM CUSTOMER
        INNER JOIN ADDRESS ON CUSTOMER.ADDRESS_ID = ADDRESS.ADDRESS_ID
        INNER JOIN CITY ON ADDRESS.CITY_ID = CITY.CITY_ID
        INNER JOIN COUNTRY ON CITY.COUNTRY_ID = COUNTRY.COUNTRY_ID
        GROUP BY COUNTRY. COUNTRY
        ORDER BY COUNT(CUSTOMER.CUSTOMER_ID) DESC
        LIMIT 10),
    TOP_CITIES AS
    (SELECT CITY.CITY
        FROM CUSTOMER
        INNER JOIN ADDRESS ON CUSTOMER.ADDRESS_ID = ADDRESS.ADDRESS_ID
        INNER JOIN CITY ON ADDRESS.CITY_ID = CITY.CITY_ID
        INNER JOIN COUNTRY ON CITY.COUNTRY_ID = COUNTRY.COUNTRY_ID
        WHERE COUNTRY.COUNTRY IN
                (SELECT *
                    FROM TOP_10_COUNTRIES)
        GROUP BY COUNTRY.COUNTRY,
            CITY.CITY
        ORDER BY COUNT (CUSTOMER.CUSTOMER_ID) DESC
        LIMIT 10),
    TOP_CUSTOMERS AS
    (SELECT SUM(PAYMENT.AMOUNT) AS TOTAL_AMOUNT
        FROM CUSTOMER
        INNER JOIN ADDRESS ON CUSTOMER.ADDRESS_ID = ADDRESS. ADDRESS_ID
        INNER JOIN CITY ON ADDRESS.CITY_ID = CITY.CITY_ID
        INNER JOIN COUNTRY ON CITY.COUNTRY_ID = COUNTRY.COUNTRY_ID
        INNER JOIN PAYMENT ON CUSTOMER.CUSTOMER_ID = PAYMENT.CUSTOMER_ID
        WHERE CITY.CITY in
                (SELECT *
                    FROM TOP_CITIES)
        GROUP BY CUSTOMER.FIRST_NAME,
            CUSTOMER.LAST_NAME,
            CITY.CITY,
            COUNTRY.COUNTRY
        ORDER BY TOTAL_AMOUNT DESC
        LIMIT 5)
SELECT AVG(TOTAL_AMOUNT)
FROM TOP_CUSTOMERS
```
